#!/usr/bin/env python3
# chatbot_assistente_emocional.py
import re
import time

def ask(prompt):
    return input(prompt + "\n> ").strip().lower()

def pausa(texto):
    """Simula um tempo de resposta do bot"""
    print(f"\nBot: {texto}")
    time.sleep(5)

def detectar_humor(texto):
    """Analisa o humor com base na resposta do usuÃ¡rio"""
    humor_positivo = ["Sim", "Estou bem", "bem", "Ã³timo", "otimo", "tranquilo", "Estou feliz", "feliz", "bom"]
    humor_negativo = ["NÃ£o", "mal", "cansado", "triste", "ruim", "pÃ©ssimo", "pessimo", "estressado", "irritado", "ansioso", "preocupado"]
    for palavra in humor_positivo:
        if palavra in texto:
            return "positivo"
    for palavra in humor_negativo:
        if palavra in texto:
            return "negativo"
    return "neutro"

class SolucaoManager:
    """Gerencia as soluÃ§Ãµes passo a passo para cada problema"""
    
    def __init__(self):
        self.solucoes = {
            "internet": [
                "ğŸ”Œ Verifique se o cabo de rede estÃ¡ conectado firmemente ao computador e ao roteador",
                "ğŸ”„ Reinicie o modem/roteador: desconecte da tomada por 30 segundos e conecte novamente",
                "ğŸ“± Teste a internet em outro dispositivo para isolar o problema",
                "ğŸ” Verifique se o adaptador Wi-Fi estÃ¡ habilitado nas configuraÃ§Ãµes de rede",
                "ğŸ› ï¸ Execute a soluÃ§Ã£o de problemas de rede do Windows (ou equivalente)",
                "ğŸ“ Entre em contato com seu provedor de internet para verificar se hÃ¡ problemas na regiÃ£o"
            ],
            "impressora": [
                "ğŸ”Œ Verifique se a impressora estÃ¡ ligada e todas as luzes estÃ£o acesas",
                "ğŸ”— Confirme se o cabo USB ou conexÃ£o de rede estÃ¡ firmemente conectado",
                "ğŸ“„ Verifique se hÃ¡ papel na bandeja e se nÃ£o estÃ¡ emperrado",
                "ğŸ–¨ï¸ Execute o utilitÃ¡rio de limpeza de bicos da impressora",
                "ğŸ”§ Reinstale os drivers da impressora no computador",
                "ğŸ”„ Atualize o firmware da impressora pelo site do fabricante"
            ],
            "login": [
                "ğŸ‘ï¸ Verifique se o CAPS LOCK estÃ¡ desligado ao digitar a senha",
                "ğŸ”„ Tente redefinir a senha usando a opÃ§Ã£o 'Esqueci minha senha'",
                "ğŸŒ Se Ã© login online, verifique sua conexÃ£o com a internet",
                "ğŸ’» Reinicie o computador e tente fazer login novamente",
                "ğŸ”§ Use uma conta de administrador para verificar as permissÃµes",
                "ğŸ‘¨â€ğŸ’¼ Contate o administrador do sistema para verificar bloqueios na conta"
            ],
            "desempenho": [
                "ğŸ“Š Feche programas e abas nÃ£o utilizados para liberar memÃ³ria RAM",
                "ğŸ” Verifique o uso de recursos no Gerenciador de Tarefas (Ctrl+Shift+Esc)",
                "ğŸ§¹ Execute uma limpeza de disco para remover arquivos temporÃ¡rios",
                "ğŸ›¡ï¸ FaÃ§a uma verificaÃ§Ã£o completa de vÃ­rus e malware",
                "âš™ï¸ Desative programas que iniciam automaticamente com o Windows",
                "ğŸ’¾ Considere adicionar mais memÃ³ria RAM ou trocar para um SSD"
            ],
            "som": [
                "ğŸ”Š Verifique se o volume nÃ£o estÃ¡ mudo e aumente o nÃ­vel",
                "ğŸ§ Teste com fones de ouvido para isolar o problema das caixas de som",
                "ğŸ”Œ Confirme se os cabos de Ã¡udio estÃ£o conectados corretamente",
                "ğŸ”„ Reinicie o computador para restaurar os serviÃ§os de Ã¡udio",
                "ğŸ”§ Atualize os drivers de Ã¡udio pelo Gerenciador de Dispositivos",
                "ğŸ› ï¸ Execute o solucionador de problemas de Ã¡udio do Windows"
            ],
            "email": [
                "ğŸŒ Verifique sua conexÃ£o com a internet",
                "ğŸ” Confirme se o usuÃ¡rio e senha estÃ£o corretos (cuidado com caps lock)",
                "ğŸ”„ Tente acessar pelo navegador web em vez do aplicativo",
                "ğŸ“± Teste em outro dispositivo ou aplicativo de e-mail",
                "ğŸ—‘ï¸ Limpe o cache e os cookies do navegador",
                "ğŸ”§ Verifique as configuraÃ§Ãµes de servidor (POP/IMAP/SMTP)"
            ],
            "sistema": [
                "ğŸ”„ Reinicie o computador para limpar a memÃ³ria temporÃ¡ria",
                "ğŸ“¥ Verifique e instale atualizaÃ§Ãµes pendentes do Windows",
                "ğŸ” Execute uma verificaÃ§Ã£o de integridade do sistema (sfc /scannow)",
                "ğŸ’¾ Verifique o espaÃ§o livre no disco rÃ­gido (mÃ­nimo 15% recomendado)",
                "ğŸ›¡ï¸ FaÃ§a uma verificaÃ§Ã£o completa de vÃ­rus e malware",
                "âš™ï¸ Restaure o sistema para um ponto anterior quando funcionava bem"
            ]
        }
        self.passo_atual = 0
        self.tipo_problema = None
    
    def reset(self):
        self.passo_atual = 0
        self.tipo_problema = None
    
    def proximo_passo(self):
        if self.tipo_problema and self.passo_atual < len(self.solucoes[self.tipo_problema]):
            passo = self.solucoes[self.tipo_problema][self.passo_atual]
            self.passo_atual += 1
            return passo
        return None
    
    def tem_mais_solucoes(self):
        return self.tipo_problema and self.passo_atual < len(self.solucoes[self.tipo_problema])

def main():
    state = "SAUDACAO"
    nome = None
    solucao_manager = SolucaoManager()

    print("ğŸ§‘â€ğŸ’» Iniciando atendimento do Bot Assistente...\n")

    while True:
        # ETAPA 1 â€“ Pergunta o nome
        if state == "SAUDACAO":
            nome = input("Bot: Antes de comeÃ§armos, qual o seu nome?\n> ").strip().title()
            if nome:
                pausa(f"OlÃ¡ {nome}, tudo bem? ğŸ‘‹")
                state = "RESPOSTA_SAUDACAO"
            else:
                pausa("Por favor, digite um nome vÃ¡lido.")

        # ETAPA 2 â€“ Resposta ao cumprimento com detecÃ§Ã£o emocional
        elif state == "RESPOSTA_SAUDACAO":
            resposta = ask(f"{nome}")
            humor = detectar_humor(resposta)

            if humor == "positivo":
                pausa(f"Que Ã³timo, {nome}! ğŸ˜„ Fico feliz em saber que vocÃª estÃ¡ bem.")
                pausa("Vamos ver em que posso te ajudar hoje!")
            elif humor == "negativo":
                pausa(f"Poxa, {nome} ğŸ˜” Sinto muito em saber disso.")
                pausa("Espero poder te ajudar a resolver tudo e melhorar seu dia ğŸ’ª")
            else:
                pausa(f"Ok, {nome}. Vamos cuidar do seu problema juntos ğŸ˜‰")

            state = "MENU_PROBLEMA"

        # ETAPA 3 â€“ Menu de problemas
        elif state == "MENU_PROBLEMA":
            pausa(f"{nome}, com o que vocÃª precisa de ajuda hoje?")
            print("""
1ï¸âƒ£ - Problema com a Internet
2ï¸âƒ£ - Problema com a Impressora
3ï¸âƒ£ - Problema de Login
4ï¸âƒ£ - Computador Lento
5ï¸âƒ£ - Sem Som
6ï¸âƒ£ - Problema com E-mail
7ï¸âƒ£ - Sistema Operacional travando
""")
            opcao = ask("Digite o nÃºmero da opÃ§Ã£o desejada (1 a 7)")

            problemas = {
                "1": "internet",
                "2": "impressora", 
                "3": "login",
                "4": "desempenho",
                "5": "som",
                "6": "email",
                "7": "sistema"
            }

            if opcao in problemas:
                solucao_manager.reset()
                solucao_manager.tipo_problema = problemas[opcao]
                state = "FORNECER_SOLUCAO_PASSO_A_PASSO"
            else:
                pausa("âŒ NÃ£o entendi, por favor digite um nÃºmero entre 1 e 7.")
                continue

        # ETAPA 4 â€“ Fornece soluÃ§Ãµes passo a passo
        elif state == "FORNECER_SOLUCAO_PASSO_A_PASSO":
            passo = solucao_manager.proximo_passo()
            if passo:
                pausa(f"Vamos tentar esta soluÃ§Ã£o ({solucao_manager.passo_atual}/6):")
                pausa(passo)
                
                # Aguarda um pouco para o usuÃ¡rio executar
                time.sleep(2)
                
                resposta = ask("Conseguiu executar este passo? (sim/nÃ£o)")
                if "sim" in resposta:
                    pausa("Ã“timo! Vamos ver se resolveu o problema...")
                    resposta_resolvido = ask("O problema foi resolvido? (sim/nÃ£o)")
                    
                    if "sim" in resposta_resolvido:
                        pausa(f"ğŸ‰ Excelente, {nome}! Que bom que consegui resolver! ğŸ˜„")
                        state = "FINALIZADO"
                    else:
                        if solucao_manager.tem_mais_solucoes():
                            pausa("Entendo. Vamos tentar a prÃ³xima soluÃ§Ã£o...")
                            # Continua no mesmo estado para prÃ³ximo passo
                        else:
                            pausa("ğŸ˜” Infelizmente esgotamos todas as soluÃ§Ãµes automÃ¡ticas.")
                            state = "ESCALAR_SUPORTE"
                else:
                    pausa("Sem problemas. Vamos para a prÃ³xima alternativa...")
                    if not solucao_manager.tem_mais_solucoes():
                        pausa("ğŸ˜” Infelizmente esgotamos todas as soluÃ§Ãµes automÃ¡ticas.")
                        state = "ESCALAR_SUPORTE"
            else:
                pausa("ğŸ˜” Infelizmente esgotamos todas as soluÃ§Ãµes automÃ¡ticas.")
                state = "ESCALAR_SUPORTE"

        # ETAPA 5 â€“ Escalar para suporte avanÃ§ado
        elif state == "ESCALAR_SUPORTE":
            pausa("ğŸ“ Para um atendimento mais personalizado, posso:")
            print("""
1ï¸âƒ£ - Abrir um ticket de suporte tÃ©cnico
2ï¸âƒ£ - Direcionar para atendimento via WhatsApp
3ï¸âƒ£ - Voltar ao menu principal
""")
            opcao = ask("Qual opÃ§Ã£o vocÃª prefere? (1, 2 ou 3)")
            
            if opcao == "1":
                pausa(f"âœ… Ticket aberto para {nome}! Nossa equipe entrarÃ¡ em contato em atÃ© 2 horas Ãºteis.")
                state = "FINALIZADO"
            elif opcao == "2":
                problema_desc = solucao_manager.tipo_problema if solucao_manager.tipo_problema else "problema tÃ©cnico"
                pausa(f"ğŸ“± Perfeito! Entre em contato pelo WhatsApp (55 62 99402-0436)")
                pausa(f"ğŸ’¬ Ao enviar mensagem, informe: 'Atendimento Bot Assistente - {nome} - Problema: {problema_desc}'")
                pausa("Nossa equipe te atenderÃ¡ o mais rÃ¡pido possÃ­vel!")
                state = "FINALIZADO"
            elif opcao == "3":
                pausa("Voltando ao menu principal...")
                state = "MENU_PROBLEMA"
            else:
                pausa("âŒ OpÃ§Ã£o invÃ¡lida. Por favor, escolha 1, 2 ou 3.")

        # ETAPA FINAL â€“ Pergunta se deseja outro atendimento
        elif state == "FINALIZADO":
            resposta = ask(f"\n{nome}, deseja falar sobre outro problema? (sim/nÃ£o)")
            if "sim" in resposta:
                pausa(f"Perfeito, {nome}! Vamos lÃ¡ novamente ğŸ’ª")
                state = "MENU_PROBLEMA"
            elif "nÃ£o" in resposta or "nao" in resposta:
                pausa(f"Obrigado por usar o Bot Assistene, {nome}. Tenha um excelente dia! ğŸ‘‹")
                break
            else:
                pausa("âŒ NÃ£o entendi, digite 'sim' ou 'nÃ£o'.")

# CORREÃ‡ÃƒO: Esta linha estava com erro de sintaxe
if __name__ == "__main__":
    main()
